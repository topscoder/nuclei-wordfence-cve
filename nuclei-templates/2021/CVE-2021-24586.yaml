id: CVE-2021-24586

info:
  name: >
    Per Page Add To Head <= 1.4.3 Cross-Site Request Forgery to Stored Cross-Site Scripting
  author: topscoder
  severity: high
  description: >
    The Per page add to head WordPress plugin before 1.4.4 is lacking any CSRF check when saving its settings, which could allow attackers to make a logged in admin change them. Furthermore, as the plugin allows arbitrary HTML to be inserted in one of the setting (feature mentioned by the plugin), this could lead to Stored XSS issue which will be triggered either in the backend, frontend or both depending on the payload used.
  reference:
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/c000a424-4060-4dcc-bae3-fa8cfc00ddda?source=api-prod
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cve-id: CVE-2021-24586
  metadata:
    fofa-query: "wp-content/plugins/per-page-add-to/"
    google-query: inurl:"/wp-content/plugins/per-page-add-to/"
    shodan-query: 'vuln:CVE-2021-24586'
  tags: cve,wordpress,wp-plugin,per-page-add-to,high

http:
  - method: GET
    redirects: true
    max-redirects: 3
    path:
      - "{{BaseURL}}/wp-content/plugins/per-page-add-to/readme.txt"

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "per-page-add-to"
        part: body

      - type: dsl
        dsl:
          - compare_versions(version, '<= 1.4.4')