id: CVE-2021-39202

info:
  name: >
    WordPress Core 5.8 beta -  Stored Cross-Site Scripting in Custom HTML Block
  author: topscoder
  severity: high
  description: >
    WordPress is a free and open-source content management system written in PHP and paired with a MySQL or MariaDB database. In affected versions the widgets editor introduced in WordPress 5.8 beta 1 has improper handling of HTML input in the Custom HTML feature. This leads to stored XSS in the custom HTML widget. This has been patched in WordPress 5.8. It was only present during the testing/beta phase of WordPress 5.8.
  reference:
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/ba4aabcc-9db8-4385-90c2-58ed93df8f9d?source=api-prod
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:L/A:N
    cvss-score: 7.6
    cve-id: CVE-2021-39202
  metadata:
    shodan-query: 'vuln:CVE-2021-39202'
  tags: cve,wordpress,wp-core,high

http:
  - method: GET
    path:
      - "{{BaseURL}}"
      - "{{BaseURL}}/wp-admin/install.php"
      - "{{BaseURL}}/feed/"
      - "{{BaseURL}}/?feed=rss2" # alternative if /feed/ is blocked

    redirects: true
    max-redirects: 2
    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - compare_versions(version_by_generator, '5.8 beta 2')
          - compare_versions(version_by_js, '5.8 beta 2')
          - compare_versions(version_by_css, '5.8 beta 2')

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        name: version_by_generator
        group: 1
        regex:
          - '(?m)https:\/\/wordpress.org\/\?v=([0-9.]+)'

      - type: regex
        name: version_by_js
        group: 1
        regex:
          - 'wp-emoji-release\.min\.js\?ver=((\d+\.?)+)\b'

      - type: regex
        name: version_by_css
        group: 1
        regex:
          - 'install\.min\.css\?ver=((\d+\.?)+)\b'
