id: CVE-2021-24229

info:
  name: >
    Patreon WordPress <= 1.7.0 - Reflected Cross-Site Scripting
  author: topscoder
  severity: critical
  description: >
    The Jetpack Scan team identified a Reflected Cross-Site Scripting via the patreon_save_attachment_patreon_level AJAX action of the Patreon WordPress plugin before 1.7.2. This AJAX hook is used to update the pledge level required by Patreon subscribers to access a given attachment. This action is accessible for user accounts with the ‘manage_options’ privilege (i.e.., only administrators). Unfortunately, one of the parameters used in this AJAX endpoint is not sanitized before being printed back to the user, so the risk it represents is the same as the previous XSS vulnerability.
  reference:
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/fc9dfe96-2d43-4b7b-a91a-87cdaaab8e49?source=api-prod
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H
    cvss-score: 9.6
    cve-id: CVE-2021-24229
  metadata:
    fofa-query: "wp-content/plugins/patreon-connect/"
    google-query: inurl:"/wp-content/plugins/patreon-connect/"
    shodan-query: 'vuln:CVE-2021-24229'
  tags: cve,wordpress,wp-plugin,patreon-connect,critical

http:
  - method: GET
    redirects: true
    max-redirects: 3
    path:
      - "{{BaseURL}}/wp-content/plugins/patreon-connect/readme.txt"

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "patreon-connect"
        part: body

      - type: dsl
        dsl:
          - compare_versions(version, '<= 1.7.2')