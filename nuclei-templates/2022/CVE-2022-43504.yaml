id: CVE-2022-43504

info:
  name: >
    WordPress Core < 6.0.3 - Stored Cross-Site Scripting via wp-mail.php
  author: topscoder
  severity: high
  description: >
    WordPress Core in versions up to 6.0.3 are vulnerable to Cross-Site Scripting via wp-mail.php. This is due to no validation on what level the user was sending the email post and therefore did not perform any sanitization on the submitted post data. This meant that users without the unfiltered_html capability, with access to submitting posts via email, could inject malicious JavaScript into posts that would execute whenever someone accessed the post.
  reference:
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/eadbfb77-fb9a-4363-acc8-8dd9b87820eb?source=api-prod
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N
    cvss-score: 7.2
    cve-id: CVE-2022-43504
  metadata:
    shodan-query: 'vuln:CVE-2022-43504'
  tags: cve,wordpress,wp-core,high

http:
  - method: GET
    path:
      - "{{BaseURL}}"
      - "{{BaseURL}}/wp-admin/install.php"
      - "{{BaseURL}}/feed/"
      - "{{BaseURL}}/?feed=rss2" # alternative if /feed/ is blocked

    redirects: true
    max-redirects: 2
    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - compare_versions(version_by_generator, '>= 6.0', '<= 6.0.2')
          - compare_versions(version_by_js, '>= 6.0', '<= 6.0.2')
          - compare_versions(version_by_css, '>= 6.0', '<= 6.0.2')

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        name: version_by_generator
        group: 1
        regex:
          - '(?m)https:\/\/wordpress.org\/\?v=([0-9.]+)'

      - type: regex
        name: version_by_js
        group: 1
        regex:
          - 'wp-emoji-release\.min\.js\?ver=((\d+\.?)+)\b'

      - type: regex
        name: version_by_css
        group: 1
        regex:
          - 'install\.min\.css\?ver=((\d+\.?)+)\b'
