id: CVE-2022-3590

info:
  name: >
    WordPress Core <= 6.2 - Unauthenticated Blind Server Side Request Forgery
  author: topscoder
  severity: medium
  description: >
    WordPress Core, in versions up to 6.2 is vulnerable to blind Server-Side Request Forgery in its pingback feature. This is due to a Time-of-Check-Time-of-Use (TOC-TOU) race condition between validation checks and HTTP requests that makes it possible for URLs to be validated and then changed before being used by the software. This makes it possible for an attacker to change the domain in a pingback request to point to a different address than the one validated before, thus exposing hosts that should not be reachable on a server. The original researcher couldn't identify any ways to exploit this to take over vulnerable sites without other vulnerable services on the site meaning this would be difficult to exploit. The issue was first reported in 2017 and it's recommendd to block xmlrpc.php at the web server level, if not in use to prevent this from being exploited.
  reference:
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/112ed4f2-fe91-4d83-a3f7-eaf889870af4?source=api-prod
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:L/I:N/A:N
    cvss-score: 4
    cve-id: CVE-2022-3590
  metadata:
    shodan-query: 'vuln:CVE-2022-3590'
  tags: cve,wordpress,wp-core,medium

http:
  - method: GET
    path:
      - "{{BaseURL}}"
      - "{{BaseURL}}/wp-admin/install.php"
      - "{{BaseURL}}/feed/"
      - "{{BaseURL}}/?feed=rss2" # alternative if /feed/ is blocked

    redirects: true
    max-redirects: 2
    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - compare_versions(version_by_generator, '<= *')
          - compare_versions(version_by_js, '<= *')
          - compare_versions(version_by_css, '<= *')

      - type: status
        status:
          - 200

    extractors:
      - type: regex
        name: version_by_generator
        group: 1
        regex:
          - '(?m)https:\/\/wordpress.org\/\?v=([0-9.]+)'

      - type: regex
        name: version_by_js
        group: 1
        regex:
          - 'wp-emoji-release\.min\.js\?ver=((\d+\.?)+)\b'

      - type: regex
        name: version_by_css
        group: 1
        regex:
          - 'install\.min\.css\?ver=((\d+\.?)+)\b'
