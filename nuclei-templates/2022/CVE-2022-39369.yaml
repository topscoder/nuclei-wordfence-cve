id: CVE-2022-39369

info:
  name: >
    phpCAS authentication library < 1.6.0 - Service Hostname Discovery Exploitation
  author: topscoder
  severity: high
  description: >
    The phpCAS library uses HTTP headers to determine the service URL used to validate tickets. This allows an attacker to control the host header and use a valid ticket granted for any authorized service in the same SSO realm (CAS server) to authenticate to the service protected by phpCAS. Depending on the settings of the CAS server service registry in worst case this may be any other service URL (if the allowed URLs are configured to "^(https)://.*") or may be strictly limited to known and authorized services in the same SSO federation if proper URL service validation is applied.
    
    This vulnerability may allow an attacker to gain access to a victim's account on a vulnerable CASified service without victim's knowledge, when the victim visits attacker's website while being logged in to the same CAS server. WordPress plugins containing a vulnerable copy of this library may or may not be vulnerable to exploitation.
  reference:
    - https://www.wordfence.com/threat-intel/vulnerabilities/id/7d8365a6-dfa2-4753-b655-3c2bcadeae75?source=api-prod
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:H
    cvss-score: 8
    cve-id: CVE-2022-39369
  metadata:
    fofa-query: "wp-content/plugins/authorizer/"
    google-query: inurl:"/wp-content/plugins/authorizer/"
    shodan-query: 'vuln:CVE-2022-39369'
  tags: cve,wordpress,wp-plugin,authorizer,high

http:
  - method: GET
    redirects: true
    max-redirects: 3
    path:
      - "{{BaseURL}}/wp-content/plugins/authorizer/readme.txt"

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        internal: true
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - "(?mi)Stable tag: ([0-9.]+)"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "authorizer"
        part: body

      - type: dsl
        dsl:
          - compare_versions(version, '<= 1.6.0 ')